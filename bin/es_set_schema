#!/usr/bin/env ruby

require "datura"

require "json"
require "rest-client"
require "yaml"

params = Datura::Parser.es_set_schema_params
path = File.join(File.expand_path(File.dirname(__FILE__)), "..", "lib", "config", "api_schema.yml")
schema = YAML.load_file(path)
options = Datura::Options.new(params).all

begin
  idx = options["es_index"]

  url = "#{options["es_path"]}/#{idx}/_mapping/_doc?pretty"
  puts "environment: #{options["environment"]}"
  puts "Setting schema: #{url}"
  RestClient.put(url, schema.to_json, { :content_type => :json })
rescue => e
  puts "Error: #{e.response}"
end
